# GETTING STARTED GUIDE

This guide assumes that you've [Humankind Mod Tool](https://gc2021.com/showthread.php?tid=3) installed and properly configured.

## SETUP

If you've not updated the **References** generated by **Humankind Mod Tool** recently, I suggest you to do so:

* Remove the `%USERPROFILE%\Documents\Humankind Mod Tool\References` directory.
* In **Humankind Mod Tool**
* Click on the **Decompile Game Scripts** button under the **Create** tab.
* Create a new project to rebuild your **References**, you can delete the project afterwards.

## FINDING HIDDEN GAME WINDOWS IN CODE

**dnSpy** is a great tool but to do this, **JetBrains dotPeek** suits us better. You can get it [here](https://www.jetbrains.com/decompiler/), it's free.

In **JetBrains dotPeek**, do the following steps:

* `File > Clear Assembly List` to remove any previously/default loaded assemblies.
* `File > Explore Folder...` to select `%USERPROFILE%\Documents\Humankind Mod Tool\References`.
* In the `Type to search` text field within the **Assembly Explorer** window, type:
  `FloatingWindow`
* After a little wait, right click on `FloatingWindow` under `Amplitude.Framework.Overlay` namespace and choose `Hierarchies`.

You'll see a list of many, **but not all**, of those hidden windows.

## HOW TO: DISPLAY A WINDOW IN YOUR PLUGIN

First of all, there's some work required in order to properly use Unity's **IMGUI** windows in Humankind but I've unified them in a single BepInEx plugin that takes care of them all.

* Download the [AnN3x.Humankind.UI](https://github.com/Theadd/HumankindHacks/tree/main/lib/AnN3x.Humankind.UI) library and put it under your `.\Humankind\BepInEx\plugins\` directory.
* Add it as a reference in your `*.csproj` file, just like other references you already have there.
* Also, tell BepInEx that your plugin has the UI plugin as a dependency by annotating your plugin class with `[BepInDependency("AnN3x.Humankind.UI")]`.

> **AnN3x.Humankind.UI**'s source can be found [here](https://github.com/Theadd/HumankindHacks/tree/main/src/UI). If instead of adding that library as a reference you copy the sources into your plugin, customize the string values from the [Config](https://github.com/Theadd/HumankindHacks/blob/main/src/UI/Core/Config.cs) class to your own unique values to avoid conflicts.

For this example, we will bring the `FloatingWindow_PlayerProfile` from Humankind's code into our plugin.

### CUSTOM BASE CLASS

In order to easily bring any other game window into our code, let's create a base class:

*CustomWindow.cs*
```csharp
using AnN3x.UI;
using UnityEngine;

namespace MyCustomNamespace
{
    public abstract class CustomWindow : FloatingToolWindow
    {
        public override bool ShouldBeVisible { get; } = true;
        public override bool UsePlayerPrefs { get; } = true;
        public override bool RestoreLastWindowPosition { get; } = true;
        public override string WindowGUIStyle { get; set; } = "PopupWindow";
        public override Rect WindowRect { get; set; } = new Rect(150f, 150f, 640f, 500f);
        public override void OnDrawUI() => OnDrawWindowClientArea(0);
    }
}
```

### IMPORT THE WINDOW

*This method will work for all game classes deriving from the `FloatingWindow` class.*

* Copy the entire file containing the `FloatingWindow_PlayerProfile` class into your project, you can also find it here:
  `%USERPROFILE%\Documents\Humankind Mod Tool\Decompiled\Assembly-CSharp\Amplitude\Mercury\Overlay\FloatingWindow_PlayerProfile.cs`
* Change it's namespace to your own and make this class derive only from your `CustomWindow` base class we declared above (in this case, we also had to add the missing `using Amplitude.Mercury;` directive).
    <blockquote>So, the following original lines:

    ```csharp
    // ...
    using UnityEngine;

    namespace Amplitude.Mercury.Overlay
    {
        public class FloatingWindow_PlayerProfile : FloatingWindow, IPopupWindowWithAdjustableWindowHeight
        {
            // ...
    ```
  Became:
    ```csharp
    // ...
    using UnityEngine;
    using Amplitude.Mercury;

    namespace MyCustomNamespace
    {
        public class FloatingWindow_PlayerProfile : CustomWindow
        {
            // ...
    ```

  *If you also change the class name, change all occurrences of it in that file.*
    </blockquote>

### LOAD AND PROPERLY UNLOAD THE WINDOW

A simple example of doing so is the following:

```csharp
using AnN3x.UI;
using BepInEx;

namespace MyCustomNamespace
{
    [BepInPlugin(PluginInfo.PLUGIN_GUID, PluginInfo.PLUGIN_NAME, PluginInfo.PLUGIN_VERSION)]
    [BepInDependency("AnN3x.Humankind.UI")]
    public class Plugin : BaseUnityPlugin
    {
        public static FloatingWindow_PlayerProfile PlayerProfileWindow { get; set; }

        private void Awake()
        {
            // This will open a FloatingWindow_PlayerProfile once the UI is ready, retrieving the window
            // instance with the callback.
            PopupToolWindow.Open<FloatingWindow_PlayerProfile>(w => PlayerProfileWindow = w);
        }

        private void OnDestroy()
        {
            PlayerProfileWindow?.Close();
            Destroy(gameObject);
        }
    }
}
```
